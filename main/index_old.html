<html>

<head>
    <title>主页面main</title>
    <script type="text/javascript" src="jquery-3.6.0.min.js"></script>
    <script type="text/javascript">

        var token;
        var uid;
        var uname;
        window.onload = function () {
            var arr = window.location.toString().split('=');
            uid = arr[1].split('&')[0];
            token = arr[2];
            console.log(uid, token);
            //alert(uid);
            //alert(token);
            $.post('/getuserinfo', {uid: uid}, function (data, result) {
                uname = data.data[0].uname;
                document.getElementById("uname").innerHTML = "昵称：" + uname;
                document.getElementById("uid").innerHTML = "ID：" + uid;
            });
            getfriendlist(token);
            getgrouplist(token);
        }

        function getfriendlist(_token) {
            var str = "";

            $.post('/getfriendlist', {token: _token}, function (data, status) {
                for (x in data.data) {
                    str += "<tr style='height: 50px;'><td style='background-color: aqua;'><a href='/singlechat?uid=" + uid + "&frienduid=" + data.data[x][0] + "&token=" + token + "'>" + data.data[x][1] + "</td></tr>";
                }
                document.getElementById("friendListTable").innerHTML = str;
            });
        }

        function getgrouplist(_token) {
            var str = "";

            $.post('/getgrouplist', {token: _token}, function (data, status) {

                for (x in data.data) {
                    str += "<tr style='height: 50px;'><td style='background-color: aqua;'><a href='/groupchat?uid=" + uid + "&groupuid=" + data.data[x] + "&token=" + token + "'>" + data.data[x] + "</td></tr>";
                }
                document.getElementById("groupListTable").innerHTML = str;
            });
        }

        function addFriendClick() {
            console.log(token);
            console.log(document.getElementById('friendid').value);
            $.post('/addfriend', {token: token, uid1: uid, uid2: document.getElementById('friendid').value}, function (data, status) {
                console.log(data);
                if (data.code == '200') {
                    getfriendlist(token);
                } else {
                    alert(data.msg);
                }
            });
        }

        function addGroupClick() {
            $.post('/addgroup', {token: token, uid: uid, groupid: document.getElementById('groupid').value, groupname: document.getElementById('groupname').value}, function (data, status) {
                console.log(data);
                if (data.code == '200') {
                    console.log('add group success');
                } else {
                    alert(data.msg);
                }
            });
        }

        function returnLogin() {
            window.location.replace('/');
        }
    </script>

    <style type="text/css">
        a:link{
            color: #000;
        }
        a:visited{
            color: #000;
        }
        .buttonClass{
            width: 100px;
            height: 40px;
            background-color: lightskyblue;
        }
        input[type='text'] {
            height: 40px;
        }
        * {
            font-size: 20px;
            border-radius: 10px;
        }
    </style>

</head>



<body style="background-color: beige;">

<h1 style="text-align: center; font-size: 50px;">主界面</h1>
<h2 id="uname" style="font-size: 30px"></h2>
<h2 id="uid" style="font-size: 30px"></h2>
<hr>

<p style="font-size: 10px; color: grey; text-align: right;">功能区</p>
<input type="button" class="buttonClass" value="退出登陆" onclick="returnLogin()">


<div id="addFriendDiv" style="text-align: center">
    <h1 style="text-align: center">添加好友</h1>
    <form id="addFriendForm">
        <input type="text" id="friendid" placeholder="对方id">
        <input type="button" class="buttonClass" id="addFriendButton" value="添加好友" onclick="addFriendClick()">
    </form>

    <form id="addGroupForm">
        <input type="text" id="groupid" placeholder="群聊id">
        <input type="text" id="groupname" placeholder="群聊名称（注册时输入）">
        <input type="button" class="buttonClass" id="addGroupButton" value="加入群聊" onclick="addGroupClick()">
    </form>
</div>

<hr>

<p style="font-size: 10px; color: grey; text-align: right;">聊天区</p>
<div id="friendListDiv" style="text-align: center">

    <h1>好友列表</h1>

    <table id="friendListTable" style="text-align: center; width: 100%;">
    </table>

</div>

<hr>

<p style="font-size: 10px; color: grey; text-align: right;">群聊区</p>
<div id="groupListDiv" style="text-align: center">

    <h1>群聊列表</h1>

    <table id="groupListTable" style="text-align: center; width: 100%;">
    </table>

</div>


</body>

</html>
